name: Daily Build

on:
  schedule:
    # JST 17:30 = UTC 08:30
    - cron: '30 8 * * *'
  workflow_dispatch:

jobs:
  call-test:
    uses: ./.github/workflows/test.yml
    
  notify:
    needs: call-test
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Send Slack notification
        uses: act10ns/slack@v2
        with:
          webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
          status: ${{ needs.call-test.result }}
          channel: '#general'
          message: |
            Daily Build: ${{ needs.call-test.result }}
            Repository: ${{ github.repository }}
            Branch: ${{ github.ref_name }}
            Triggered by: ${{ github.event_name == 'schedule' && 'Scheduled (17:30 JST)' || 'Manual' }}
            View Run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}